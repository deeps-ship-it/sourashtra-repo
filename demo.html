<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Audio Model Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@0.4.0/dist/speech-commands.min.js"></script>

    <style>
         body { font-family: Arial; padding: 40px; }

    button {
        width: 100%;
        padding: 16px 24px;
        font-size: 18px;
        background-color: #DAD9FB;
        color: black;
        border: none;
        border-radius: 999px; /* fully rounded */
        cursor: pointer;
        font-weight: 600;
    }

    #label { margin-top: 20px; font-size: 24px; font-weight: bold; }
    </style>
</head>

<body>

<h2>Sourashtra Audio Model Demo</h2>
<button onclick="startListening()"> Start Microphone</button>

<div id="label">Waiting...</div>

<script>

async function loadModel() {
    const MODEL_URL = "https://deeps-ship-it.github.io/sourashtra-repo/model.json";
    const METADATA_URL = "https://deeps-ship-it.github.io/sourashtra-repo/metadata.json";

    const recognizer = speechCommands.create(
        "BROWSER_FFT",
        undefined,
        MODEL_URL,
        METADATA_URL
    );

    await recognizer.ensureModelLoaded();
    return recognizer;
}

async function startListening() {
    document.getElementById("label").innerHTML = "Listening...";

    const recognizer = await loadModel();

    recognizer.listen(result => {
        let scores = result.scores;
        let labels = recognizer.wordLabels();

        let highest = labels[scores.indexOf(Math.max(...scores))];

        document.getElementById("label").innerHTML = "Detected: " + highest;

    }, {
        includeSpectrogram: true,
        probabilityThreshold: 0.75
    });
}

</script>


</body>
</html>
